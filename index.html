<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Is Robby Preaching?</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      height: 100vh;
      margin: 0;
      font-family: Arial, sans-serif;
    }
    #answer {
      font-size: 100pt;
      font-weight: bold;
    }
    #date {
      font-size: 14pt;
      color: black;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div id="answer"></div>
  <div id="date"></div>

  <!-- Timezone + CSV Parsing libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.43/moment-timezone-with-data.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <script>
    // Replace with your published Google Sheet CSV link
    const sheetCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRXdkA2dHQx1VffPgvfKuec47DYdSTUYyYeDw24tHwkaa-zkYbEX4I4rlUtN7FRzocupRYl0udlRnYn/pub?output=csv";

    function fetchData() {
      Papa.parse(sheetCSV, {
        download: true,
        header: true,
        complete: function(results) {
          const data = results.data;

          // Sort rows by date
          data.sort((a, b) => new Date(a.Date) - new Date(b.Date));

          // Current time in CDT
          const now = moment.tz("America/Chicago");

          let currentRow = null;

          // Find the next upcoming Sunday row
          for (let row of data) {
            if (!row.Date) continue;
            let rowDate = moment.tz(row.Date, "MM/DD/YYYY", "America/Chicago").hour(15); // 3PM cutoff
            if (now.isBefore(rowDate)) {
              currentRow = row;
              break;
            }
          }

          // If no future row found, fallback to the last available one
          if (!currentRow && data.length > 0) {
            currentRow = data[data.length - 1];
          }

          // Display YES/NO
          const answerDiv = document.getElementById("answer");
          if (currentRow && currentRow.Answer && currentRow.Answer.toUpperCase() === "YES") {
            answerDiv.textContent = "YES";
            answerDiv.style.color = "green";
          } else {
            answerDiv.textContent = "NO";
            answerDiv.style.color = "red";
          }

          // Display date in readable format
          if (currentRow && currentRow.Date) {
            const formattedDate = moment(currentRow.Date, "MM/DD/YYYY").format("dddd, MMMM D, YYYY");
            document.getElementById("date").textContent = formattedDate;
          }
        }
      });
    }

    // Initial fetch
    window.addEventListener("DOMContentLoaded", fetchData);

    // Refresh every 60 seconds
    setInterval(fetchData, 60000);
  </script>
</body>
</html>
